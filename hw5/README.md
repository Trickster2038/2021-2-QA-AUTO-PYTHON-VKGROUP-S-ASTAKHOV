# Домашнее задание №5: Backend: Linux

# Bash

- Количество запросов считается как количество строк в логе
- Число запросов по типу - awk выбирается колонка с типом запроса, обрезается символ кавычки, список сортируется, отбираются уникальные значения с подсчетом повторений, строка форматируется с помощью awk
  - Для обычных запросов в начале проверяется что длина названия типа меньше 10 символов
  - Для аномального запроса, что длина  >=10 символам
- 10 самых частых запросов - отфильтровывается столбец с url, сортируется, отбираются уникальные значения с подсчетом повторений, список сортируется по столбцу подсчета (с учетом того, что это число), отбираются первые 10
- 5 самых больших запросов с 4хх ошибкой - отбираются запросы у которых код удовлетвоярет регулярному выражению для числе вида 4хх, отбираются необходимые колонки, сортируются по убыванию по колонке размера (с учетом того, что это число), отбираются первые 5
- топ 5 пользователей по количеству запросов с ошибками 5хх - отбираются IP, запросы у которых код удовлетвоярет регулярному выражению для числе вида 5хх, список сортируется, отбираются уникальные значения с подсчетом повторений, список форматируется с помощью awk, отбирается 5 первых строк

# Python

- Лог разбирается как CSV файл и преобразуется в pandas.DataFrame (далее, для краткости - DF)
- Число запросов - количество строк в DF
- Число запросов по типу - колонка с url и типом запроса разбивается и тип запроса копируется в отдельную колонку, из нее создается отдельный DF, он группируется по полю с типом запроса с подсчетом вхождений в каждую группу (повторений), аномалия выделяется по длине поля с типом запроса (аналогично bash)
- Топ 10 самых популярных запросов - выделяется колонка с url и типом запроса разбивается и url отфильтровывается, он группируется по полю с url с подсчетом вхождений в каждую группу (повторений), отбираются первые 10 строк
- 5 самых больших запросов с 4хх ошибкой - отбираются запросы с кодами 5хх и известным (не "-") размером, отбиаются нужные колонки, колонке с размером задается целочисленный тип, DF сортируется по размеру по убыванию, отбираются первые 5 запросов
- топ 5 пользователей по количеству запросов с ошибками 5хх - отбираются IP, запросы у которых код имеет вид 5хх, происходит группировка по IP с подсчетом повторений, сортировка по убыванию, отбираются первые 5 запросов
- В зависимости от наличия флага *--json* полученные DF либо конвертируются в строку, либо в json (с ними и комментарии) и записываются в файл

# Вывод

Написание bash скриптов позволяет писать более компактный код, а так же удобнее для интерактивного режима, так как зачастую укладывается в одну строчку, так же оно значительно быстрее, чем построчный анализ на python (а разбить лог как csv не всегда легко + это приводит к потере последних колонок, так как pandas не может иметь переменную длину строк DF). Минусом bash скриптов является их меньшая читаемость, а так же сложность преобразования результатов в другие форматы и дальнейшей работы с ними, в то время как в python имеются любые возможности для дальнейшей работы с данными.
